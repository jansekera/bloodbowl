var S=Object.defineProperty;var y=(g,e,t)=>e in g?S(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t;var n=(g,e,t)=>y(g,typeof e!="symbol"?e+"":e,t);const r=class r{constructor(e=32,t=40,i=40){n(this,"cellSize");n(this,"paddingX");n(this,"paddingY");n(this,"pitchWidth");n(this,"pitchHeight");n(this,"canvasWidth");n(this,"canvasHeight");this.cellSize=e,this.paddingX=t,this.paddingY=i,this.pitchWidth=r.COLS*e,this.pitchHeight=r.ROWS*e,this.canvasWidth=this.pitchWidth+2*t,this.canvasHeight=this.pitchHeight+2*i}gridToPixel(e){return{px:this.paddingX+e.x*this.cellSize+this.cellSize/2,py:this.paddingY+e.y*this.cellSize+this.cellSize/2}}pixelToGrid(e,t){const i=Math.floor((e-this.paddingX)/this.cellSize),o=Math.floor((t-this.paddingY)/this.cellSize);return i<0||i>=r.COLS||o<0||o>=r.ROWS?null:{x:i,y:o}}gridToTopLeft(e){return{px:this.paddingX+e.x*this.cellSize,py:this.paddingY+e.y*this.cellSize}}isHomeEndZone(e){return e.x===0}isAwayEndZone(e){return e.x===r.COLS-1}isWideZone(e){return e.y<r.WIDE_ZONE_TOP||e.y>=r.WIDE_ZONE_BOTTOM}isLineOfScrimmage(e){return e.x===r.LOS_COL-1||e.x===r.LOS_COL}isOnPitch(e){return e.x>=0&&e.x<r.COLS&&e.y>=0&&e.y<r.ROWS}distance(e,t){return Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}getAdjacentPositions(e){const t=[];for(let i=-1;i<=1;i++)for(let o=-1;o<=1;o++){if(i===0&&o===0)continue;const l={x:e.x+i,y:e.y+o};this.isOnPitch(l)&&t.push(l)}return t}};n(r,"COLS",26),n(r,"ROWS",15),n(r,"LOS_COL",13),n(r,"WIDE_ZONE_TOP",4),n(r,"WIDE_ZONE_BOTTOM",11);let h=r;const u={grass:"#2d5a1e",grassAlt:"#2a5319",endZoneHome:"#1a3a5c",endZoneAway:"#5c1a1a",wideZone:"rgba(255, 255, 255, 0.03)",gridLine:"rgba(255, 255, 255, 0.12)",losLine:"rgba(255, 255, 255, 0.5)",highlight:"rgba(255, 255, 100, 0.3)",highlightMove:"rgba(100, 200, 255, 0.25)",highlightBlock:"rgba(255, 100, 100, 0.25)"},b={primary:"#2980b9",secondary:"#1a5276",text:"#fff"},T={primary:"#c0392b",secondary:"#7b241c",text:"#fff"};class O{constructor(e,t=32,i){n(this,"ctx");n(this,"geometry");n(this,"colors");n(this,"animState",null);this.canvas=e;const o=e.getContext("2d");if(!o)throw new Error("Cannot get 2d context");this.ctx=o,this.geometry=new h(t),this.colors={...u,...i},e.width=this.geometry.canvasWidth,e.height=this.geometry.canvasHeight}setAnimationState(e){this.animState=e}render(e,t,i=[],o=null,l=null){var s,a;this.clear(),this.drawPitch(),this.drawHighlights(i),l&&this.drawCellHighlight(l,"rgba(255, 255, 255, 0.1)"),this.drawPlayers(e,o),(s=this.animState)!=null&&s.flashCell&&this.drawCellHighlight(this.animState.flashCell.pos,this.animState.flashCell.color),(a=this.animState)!=null&&a.ballOverride?this.drawBallAtPixel(this.animState.ballOverride.px,this.animState.ballOverride.py):t&&!t.isHeld&&t.position&&this.drawBall(t.position)}clear(){this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawPitch(){const{ctx:e,geometry:t,colors:i}=this;for(let l=0;l<h.COLS;l++)for(let s=0;s<h.ROWS;s++){const a={x:l,y:s},{px:c,py:d}=t.gridToTopLeft(a);e.fillStyle=(l+s)%2===0?i.grass:i.grassAlt,e.fillRect(c,d,t.cellSize,t.cellSize),t.isHomeEndZone(a)?(e.fillStyle=i.endZoneHome,e.fillRect(c,d,t.cellSize,t.cellSize)):t.isAwayEndZone(a)&&(e.fillStyle=i.endZoneAway,e.fillRect(c,d,t.cellSize,t.cellSize)),t.isWideZone(a)&&(e.fillStyle=i.wideZone,e.fillRect(c,d,t.cellSize,t.cellSize))}e.strokeStyle=i.gridLine,e.lineWidth=.5;for(let l=0;l<=h.COLS;l++){const s=t.paddingX+l*t.cellSize;e.beginPath(),e.moveTo(s,t.paddingY),e.lineTo(s,t.paddingY+t.pitchHeight),e.stroke()}for(let l=0;l<=h.ROWS;l++){const s=t.paddingY+l*t.cellSize;e.beginPath(),e.moveTo(t.paddingX,s),e.lineTo(t.paddingX+t.pitchWidth,s),e.stroke()}e.strokeStyle=i.losLine,e.lineWidth=2;const o=t.paddingX+h.LOS_COL*t.cellSize;e.beginPath(),e.moveTo(o,t.paddingY),e.lineTo(o,t.paddingY+t.pitchHeight),e.stroke(),e.strokeStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=1,e.setLineDash([4,4]);for(const l of[h.WIDE_ZONE_TOP,h.WIDE_ZONE_BOTTOM]){const s=t.paddingY+l*t.cellSize;e.beginPath(),e.moveTo(t.paddingX,s),e.lineTo(t.paddingX+t.pitchWidth,s),e.stroke()}e.setLineDash([]),e.strokeStyle="#fff",e.lineWidth=2,e.strokeRect(t.paddingX,t.paddingY,t.pitchWidth,t.pitchHeight),e.fillStyle="#aaa",e.font="11px system-ui, sans-serif",e.textAlign="center",e.fillText("HOME",t.paddingX+t.cellSize/2,t.paddingY-10),e.fillText("AWAY",t.paddingX+t.pitchWidth-t.cellSize/2,t.paddingY-10)}drawHighlights(e){for(const t of e)this.drawCellHighlight(t,this.colors.highlightMove)}drawCellHighlight(e,t){const{ctx:i,geometry:o}=this,{px:l,py:s}=o.gridToTopLeft(e);i.fillStyle=t,i.fillRect(l+1,s+1,o.cellSize-2,o.cellSize-2)}drawPlayers(e,t){for(const i of e)i.position&&this.drawPlayerSprite(i,i.id===t)}drawPlayerSprite(e,t){var f,m;if(!e.position)return;const{ctx:i,geometry:o}=this;let{px:l,py:s}=o.gridToPixel(e.position);const a=(f=this.animState)==null?void 0:f.playerOverrides.get(e.id);a&&(l=a.px,s=a.py);const c=(m=this.animState)==null?void 0:m.shakePlayer;c&&c.playerId===e.id&&(l+=c.offsetX,s+=c.offsetY);const d=o.cellSize*.38,p=e.teamSide==="home"?b:T;t&&(i.beginPath(),i.arc(l,s,d+3,0,Math.PI*2),i.strokeStyle="#ffff00",i.lineWidth=2,i.stroke()),i.beginPath(),i.arc(l,s,d,0,Math.PI*2),i.fillStyle=p.primary,i.fill(),i.strokeStyle=p.secondary,i.lineWidth=1.5,i.stroke(),i.fillStyle=p.text,i.font=`bold ${Math.round(o.cellSize*.38)}px system-ui, sans-serif`,i.textAlign="center",i.textBaseline="middle",i.fillText(String(e.number),l,s+1),(e.state==="prone"||e.state==="stunned")&&(i.save(),i.globalAlpha=.5,i.beginPath(),i.arc(l,s,d,0,Math.PI*2),i.fillStyle=e.state==="stunned"?"#ff0":"#888",i.fill(),i.restore(),i.fillStyle="#000",i.fillText(String(e.number),l,s+1)),e.lostTacklezones&&(i.save(),i.setLineDash([3,3]),i.beginPath(),i.arc(l,s,d+1,0,Math.PI*2),i.strokeStyle="rgba(128, 128, 128, 0.7)",i.lineWidth=2,i.stroke(),i.setLineDash([]),i.restore()),(e.hasMoved||e.hasActed)&&(i.beginPath(),i.arc(l+d-2,s-d+2,3,0,Math.PI*2),i.fillStyle="#aaa",i.fill())}drawBall(e){const{geometry:t}=this,{px:i,py:o}=t.gridToPixel(e);this.drawBallAtPixel(i,o-t.cellSize*.25)}drawBallAtPixel(e,t){const{ctx:i,geometry:o}=this,l=o.cellSize*.15;i.beginPath(),i.arc(e,t,l,0,Math.PI*2),i.fillStyle="#8B4513",i.fill(),i.strokeStyle="#fff",i.lineWidth=1,i.stroke()}drawSetupZone(e){const{ctx:t,geometry:i}=this,o=e==="home"?0:h.LOS_COL,l=e==="home"?h.LOS_COL-1:h.COLS-1;t.fillStyle="rgba(100, 255, 100, 0.08)";for(let s=o;s<=l;s++)for(let a=0;a<h.ROWS;a++){const{px:c,py:d}=i.gridToTopLeft({x:s,y:a});t.fillRect(c+1,d+1,i.cellSize-2,i.cellSize-2)}}drawRiskHighlights(e){const{ctx:t,geometry:i}=this;for(const o of e){const l=o.dodges+o.gfis,{px:s,py:a}=i.gridToTopLeft({x:o.x,y:o.y});let c;if(l===0?c="rgba(100, 255, 100, 0.25)":l===1?c="rgba(255, 255, 100, 0.3)":l===2?c="rgba(255, 165, 0, 0.3)":c="rgba(255, 80, 80, 0.3)",t.fillStyle=c,t.fillRect(s+1,a+1,i.cellSize-2,i.cellSize-2),l>0){const d=[];o.dodges>0&&d.push(`D${o.dodges}`),o.gfis>0&&d.push(`G${o.gfis}`);const p=d.join("+");t.fillStyle="rgba(255, 255, 255, 0.8)",t.font=`${Math.round(i.cellSize*.28)}px system-ui, sans-serif`,t.textAlign="center",t.textBaseline="bottom",t.fillText(p,s+i.cellSize/2,a+i.cellSize-1)}}}drawSelectedTarget(e){const{ctx:t,geometry:i}=this,{px:o,py:l}=i.gridToPixel(e),s=i.cellSize*.45;t.save(),t.beginPath(),t.arc(o,l,s,0,Math.PI*2),t.strokeStyle="rgba(255, 80, 80, 0.9)",t.lineWidth=3,t.stroke();const a=i.cellSize*.15;t.strokeStyle="rgba(255, 255, 255, 0.9)",t.lineWidth=2,t.beginPath(),t.moveTo(o-a,l),t.lineTo(o-a*.3,l+a*.7),t.lineTo(o+a,l-a*.5),t.stroke(),t.restore()}drawBallOnPlayer(e){const{ctx:t,geometry:i}=this,{px:o,py:l}=i.gridToPixel(e),s=i.cellSize*.12;t.beginPath(),t.arc(o+i.cellSize*.28,l-i.cellSize*.28,s,0,Math.PI*2),t.fillStyle="#DAA520",t.fill(),t.strokeStyle="#fff",t.lineWidth=.5,t.stroke()}}class P{constructor(){n(this,"gameState",null);n(this,"selection",{selectedPlayerId:null,mode:"none",validTargets:[],hoveredCell:null,firstTargetId:null});n(this,"listeners",[])}getGameState(){return this.gameState}getSelection(){return this.selection}setGameState(e){this.gameState=e,this.clearSelection(),this.notify()}selectPlayer(e){!this.gameState||!this.getPlayerById(e)||(this.selection={selectedPlayerId:e,mode:"none",validTargets:[],hoveredCell:null,firstTargetId:null},this.notify())}setValidTargets(e,t){this.selection={...this.selection,mode:e,validTargets:t},this.notify()}setHoveredCell(e){this.selection={...this.selection,hoveredCell:e},this.notify()}clearSelection(){this.selection={selectedPlayerId:null,mode:"none",validTargets:[],hoveredCell:null,firstTargetId:null}}setFirstTarget(e,t){this.selection={...this.selection,firstTargetId:e,validTargets:t},this.notify()}getPlayerById(e){var t;return((t=this.gameState)==null?void 0:t.players.find(i=>i.id===e))??null}getPlayerAtPosition(e){var t;return((t=this.gameState)==null?void 0:t.players.find(i=>i.position&&i.position.x===e.x&&i.position.y===e.y))??null}getTeamPlayers(e){var t;return((t=this.gameState)==null?void 0:t.players.filter(i=>i.teamSide===e))??[]}isPlayerTurn(){var e;return((e=this.gameState)==null?void 0:e.activeTeam)==="home"}onChange(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notify(){for(const e of this.listeners)e()}}const k={Block:"Prevents knockdown on Both Down",Dodge:"Reroll failed dodge, forces Stumble on block","Sure Hands":"Reroll failed pickup","Sure Feet":"Reroll failed GFI",Catch:"Reroll failed catch",Pass:"+1 to passing accuracy",Frenzy:"Must follow up, second block on pushback",Tackle:"Negates Dodge skill on blocks","Mighty Blow":"+1 to armor/injury on blocks",Guard:"Provide assists even in tackle zones","Stand Firm":"Cannot be pushed back",Horns:"+1 ST on blitz",Claw:"Armor breaks on 8+ regardless of AV",Dauntless:"Roll to match stronger opponent on block","Strip Ball":"Forces ball drop on pushback",Pro:"Reroll any one roll per turn on 4+","Side Step":"Choose pushback direction","Nerves of Steel":"Ignore tackle zones for pass/catch",Loner:"Team rerolls need 4+ to use",Regeneration:"Roll 4+ to avoid casualty","Bone-head":"On 1, lose action","Really Stupid":"Need ally or 4+ to act","Wild Animal":"Need 4+ for non-block actions","Throw Team-Mate":"Can throw Stunty teammates","Right Stuff":"Can be thrown by teammates",Stunty:"+1 dodge, easier to injure","Thick Skull":"KO becomes Stunned on injury","Prehensile Tail":"+1 to dodge for leaving players","Break Tackle":"Use ST instead of AG for dodge",Sprint:"Extra GFI attempt","Jump Up":"Stand up for free to block",Leap:"Jump over squares ignoring TZ",Wrestle:"Both Down becomes both prone (no armor)",Tentacles:"Opponents roll to leave your TZ",Juggernaut:"Both Down becomes push on blitz",Grab:"Choose push direction on block","Disturbing Presence":"-1 to nearby enemy pass/catch","Diving Tackle":"+1 TZ penalty for dodging",Accurate:"+1 to passing accuracy","Strong Arm":"Reduce pass range by one category","Safe Throw":"Reroll interception attempts","Two Heads":"+1 to dodge rolls","Extra Arms":"+1 to catch and pickup","No Hands":"Cannot handle the ball","Sneaky Git":"Avoid ejection on foul doubles",Fend:"Opponent cannot follow up blocks","Piling On":"Reroll armor/injury (go prone)",Kick:"More accurate kickoff placement","Kick-Off Return":"Free move after kickoff",Leader:"+1 team reroll","Hail Mary Pass":"Throw anywhere (always inaccurate)","Dump-Off":"Quick pass when blocked","Diving Catch":"+1 catch in TZ, catch inaccurate passes","Secret Weapon":"Ejected at end of drive","Take Root":"On 1, cannot move","Big Hand":"Ignore TZ for pickup","Dirty Player":"+1 to foul armor roll",Stab:"Armor roll instead of block dice (no pushback)",Shadowing:"Follow dodging opponent on D6+MA roll",Bombardier:"Throw a bomb instead of normal pass",Bloodlust:"Must roll 2+ before action or bite a Thrall","Hypnotic Gaze":"Target adjacent opponent loses tackle zones on 2+","Ball & Chain":"Move randomly, auto-block anyone contacted",Decay:"Roll injury twice, take worse result",Chainsaw:"Auto armor roll instead of block dice, kickback on double 1","Foul Appearance":"Opponent must roll 2+ before blocking","Always Hungry":"On 1, eat thrown teammate instead of throwing","Very Long Legs":"+1 to Leap and interception rolls",Animosity:"Roll D6 when passing/handing off to different race; on 1, action fails","Pass Block":"Move up to 3 squares toward receiver when opponent declares pass","Nurgle's Rot":"Infects victim on casualty (flavor)",Titchy:"+1 dodge, opponents easier to dodge away from",Stakes:"Blocks Regeneration when causing a casualty","Multiple Block":"Block 2 adjacent opponents (each at +2 ST, no follow-up)"};class z{constructor(e){n(this,"element");this.element=document.createElement("div"),this.element.className="pitch-tooltip",this.element.style.display="none",e.appendChild(this.element)}show(e,t,i){const o=e.skills.length>0?e.skills.map(s=>{const a=k[s];return a?`<span class="pitch-tooltip__skill" title="${a}">${s}</span>`:`<span class="pitch-tooltip__skill">${s}</span>`}).join(", "):"None";this.element.innerHTML=`
            <div class="pitch-tooltip__header">
                <strong>#${e.number} ${e.name}</strong>
                <span>${e.positionalName}</span>
            </div>
            <div class="pitch-tooltip__stats">
                MA ${e.stats.movement} |
                ST ${e.stats.strength} |
                AG ${e.stats.agility} |
                AV ${e.stats.armour}
            </div>
            <div class="pitch-tooltip__skills">${o}</div>
            <div class="pitch-tooltip__status">${e.state}${e.hasMoved?" (moved)":""}</div>
        `,this.element.style.display="block",this.element.style.left=`${t+16}px`,this.element.style.top=`${i-10}px`;const l=this.element.getBoundingClientRect();l.right>window.innerWidth&&(this.element.style.left=`${t-l.width-10}px`),l.bottom>window.innerHeight&&(this.element.style.top=`${i-l.height-10}px`)}hide(){this.element.style.display="none"}destroy(){this.element.remove()}}const x={sweltering_heat:{label:"Sweltering Heat",color:"#ff6b35"},very_sunny:{label:"Very Sunny",color:"#ffd700"},nice:{label:"Nice",color:"#4caf50"},pouring_rain:{label:"Pouring Rain",color:"#42a5f5"},blizzard:{label:"Blizzard",color:"#e0e0e0"}};function v(g){return x[g]??{label:g,color:"#ccc"}}class _{constructor(e){n(this,"element");this.element=document.createElement("div"),this.element.className="scoreboard",e.appendChild(this.element)}update(e){const t=o=>e.activeTeam===o?"scoreboard__team--active":"",i=v(e.weather??"nice");this.element.innerHTML=`
            <div class="scoreboard__team ${t("home")}">
                <span class="scoreboard__name">${e.homeTeam.name}</span>
                <span class="scoreboard__race">${e.homeTeam.raceName}</span>
                <span class="scoreboard__score">${e.homeTeam.score}</span>
                <span class="scoreboard__rerolls">RR: ${e.homeTeam.rerolls}</span>
            </div>
            <div class="scoreboard__center">
                <div class="scoreboard__turn">Turn ${e.homeTeam.turnNumber} / Half ${e.half}</div>
                <div class="scoreboard__phase">${e.phase.toUpperCase()}</div>
                <div class="scoreboard__weather" style="color: ${i.color}; font-size: 0.85em;">${i.label}</div>
            </div>
            <div class="scoreboard__team ${t("away")}">
                <span class="scoreboard__name">${e.awayTeam.name}</span>
                <span class="scoreboard__race">${e.awayTeam.raceName}</span>
                <span class="scoreboard__score">${e.awayTeam.score}</span>
                <span class="scoreboard__rerolls">RR: ${e.awayTeam.rerolls}</span>
            </div>
        `}destroy(){this.element.remove()}}export{P as G,O as P,_ as S,z as T};
